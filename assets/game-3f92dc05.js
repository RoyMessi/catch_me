import{_ as V}from"./index-c9abb733.js";const ce=(e,n)=>{const t=e[n];return t?typeof t=="function"?t():Promise.resolve(t):new Promise((l,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+n)))})},ue=1,X={TEST:"test",DEV:"dev",PRODUCTION:"prod"},Z="dev",de="Catch Me",ne=!1,le=!0,oe=!0,Ee=200,_e=300,Q=-1,fe=1e3,me=300,he=3,nt={ROWS:8,COLUMNS:16,ATTRIBUTE_DATA_ROW:"data-row",ATTRIBUTE_DATA_COLUMN:"data-column",CSS_CLASS_ROW:"board-row",CSS_CLASS_COLUMN:"board-column",CSS_CLASS_BLOCK:"board-column block",BLOCKS:{}},J=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],g={UP:"up",LEFT:"left",DOWN:"down",RIGHT:"right"},pe={ArrowUp:g.UP,ArrowLeft:g.LEFT,ArrowRight:g.RIGHT,ArrowDown:g.DOWN},se="dir-",q="old-",ie=Object.values(g).join("|"),Le=new RegExp(`${se}(${ie})?`,"g"),ye=new RegExp(`${q}(${ie})?`,"g"),p={COLLECTABLE_COLLECTED:"collected",BAD_COLLECTABLE_COLLECTED:"bad_collected",LEVEL_STATISTICS:"levelStatistics",EVENTS_CALLBACKS:"eventsCallbacks",NO_MORE_COLLECTABLES:"noMoreCollectables",CAUGHT_PLAYER:"caughtPlayer",ENTERED_ENEMY_TERRITORY:"enteredEnemyTerritory",ENEMY_IS_READY_TO_SEARCH_PLAYER:"enemyIsReadyToSearchPlayer",LEVEL_STOPPED:"levelStopped",RELOAD_CURRENT_LEVEL:"reloadCurrentLevel",LOG:"log",APPEND_ELEMENT_TO_GAME:"append",APPEND_STRING_AS_DOM_TO_THE_END_OF_GAME:"appendStringAsDOM",REMOVE_ELEMENT_BY_LOCATION:"removeElementByLocation",MOVE_END:"moveEnd",PLAYER_WANTS_TO_MOVE:"playerWantsToMove",ENEMY_WANTS_TO_MOVE:"enemyWantsToMove"},ee={EASY:"easy",MEDIUM:"medium",HARD:"hard",VERY_HARD:"very_hard"},Te="./src/assets/audios/",b={DEFAULT_BACKGROUND:"default_background",HARD_LEVEL_BACKGROUND:"hard_level",COLLECTABLE_COLLECTED:"collectable_collected",BAD_COLLECTABLE_COLLECTED:"bad_collectable_collected",LEVEL_FAILED:"level_failed",LEVEL_COMPLETED:"level_completed",LEVEL_NOT_FOUND:"level_not_found",GAME_COMPLETED:"game_completed"},ve={[b.DEFAULT_BACKGROUND]:{src:"levels/easy.mp3",volume:.5,loop:!0,autoplay:!1},[b.HARD_LEVEL_BACKGROUND]:{src:"levels/hard.mp3",volume:.6,autoplay:!1,loop:!0},[b.LEVEL_NOT_FOUND]:{src:"levels/level_not_found.mp3",volume:.6,autoplay:!0,stopAllOtherSounds:!0},[b.LEVEL_FAILED]:{src:"levels/failed.mp3",volume:.6,autoplay:!0,stopAllOtherSounds:!0},[b.LEVEL_COMPLETED]:{src:"levels/done.mp3",volume:1,autoplay:!0,duration:2.5,stopAllOtherSounds:!0},[b.COLLECTABLE_COLLECTED]:{src:"collectables/good.mp3",autoplay:!0,duration:.2},[b.BAD_COLLECTABLE_COLLECTED]:{src:"collectables/bad.mp3",volume:1,autoplay:!0,duration:.5},[b.GAME_COMPLETED]:{src:"game_completed.mp3",volume:.6,autoplay:!1,loop:!1}},te=["enemy_1.svg","enemy_2.svg","enemy_3.svg","enemy_4.svg","enemy_5.svg","enemy_6.svg"],w={VERY_GOOD:"very_good",REGULAR:"regular",BAD:"bad"},k=[w.BAD],re={[w.REGULAR]:{value:1,src:"collectables/regular.svg"},[w.VERY_GOOD]:{value:4,src:"collectables/very_good.svg"},[w.BAD]:{value:-1,src:"collectables/bad.svg"}},W={collectable:Oe,player:Ae,enemy:be};function K(e,n){const t=document.createElement("div");return t.className=`opacity-0 ${e}`,t.innerHTML=n,t}function ge(e){e.classList.remove("opacity-0")}function lt(e){e.style.position="relative"}function Ce(e){return K("mobile enemy",z("enemies/"+e))}function z(e){return`<object type="image/svg+xml" data="./src/assets/icons/${e}"></object>`}function Oe(e,n){const l=`immobile collectable collectable-type-${n.replace(/_/g,"-")}`;return K(l,z(re[n].src))}function Ae(){return K("mobile player",z("player.svg"))}function be(){const e=Math.floor(Math.random()*te.length);return Ce(te[e])}function Se(){return'<div id="level_wrapper"></div>'}function Re(e){let n="",t="";return e.loadHeader&&(n+=`<h1 class="main-color">${de}!</h1>`),e.loadStatistics&&(t+=Me()),e.loadSounds&&(t+=Ie()),t&&(t=`<div id='game_info'>${t}</div>`),`<div>${n}${t}</div>`}function De(e){var t;let n="";for(let l=0;l<e.ROWS;l++){n+=`<div class='${e.CSS_CLASS_ROW}' ${e.ATTRIBUTE_DATA_ROW}='${l}'>`;for(let o=0;o<e.COLUMNS;o++){const d=(t=e.BLOCKS[l])!=null&&t.includes(o)?" block":"";n+=`<div class='${e.CSS_CLASS_COLUMN}${d}' ${e.ATTRIBUTE_DATA_COLUMN}='${o}'></div>`}n+="</div>"}return n}function Me(){let e='<div id="game_statistics" class="main-color my-2">';return e+='<span>Level</span>: <strong id="level_number">0</strong> | ',e+='<span>Collectables</span>: <strong id="remains_collectable">0</strong> | ',e+='<span>Score</span>: <strong id="score">0</strong>',e+="</div>",e}function Y(e,n,t){return`<div><input type="checkbox" ${e?" checked":""} id="${n}" /> <label for="${n}">${t}<label></div>`}function Ie(){let e='<div id="game_sounds" class="d-flex my-2 flex-gap-1 main-color">';return e+=Y(ne,"all_game_sounds","All game sounds"),e+=Y(le,"level_sounds","Level sounds"),e+=Y(oe,"collectables_sounds","Collectables sounds"),e+="</div>",e}function Ne(){let e='<div id="game_over_with_success" class="d-flex flex-center flex-d-column main-color">';return e+="<h1>Winner!</h1>",e+="<h2>Well done, you finished the game</h2>",e+="</div>",e}function we(){let e="<div id='level_not_found' class='d-flex flex-center flex-d-column main-color'>";return e+="<h2>404 Level Not Found</h2>",e+="</div>",e}function Pe(){let e="<div id='level_status' class='main-color'>";return e+="<h2>Level failed</h2>",e+='<button class="btn mt-2">Try again</button>',e+="</div>",e}function Be(){let e="<div id='level_status' class='main-color'>";return e+="<h2>Level completed</h2>",e+="</div>",e}function F(){return Math.random().toString(16).substring(2)}function Ue(){return F()+F()+F()}function Ve(e,n,t){const l=Object.assign({},n);return t===g.LEFT&&l.column>0?l.column-=1:t===g.RIGHT&&l.column<e.COLUMNS-1?l.column+=1:t===g.UP&&l.row>0?l.row-=1:t===g.DOWN&&l.row<e.ROWS-1&&(l.row+=1),l}function xe(e){return Array(e.ROWS).fill().map(t=>Array(e.COLUMNS).fill(void 0))}function Ge(e){this._matrix=xe(e),this.getMatrix=function(){return this._matrix},this.getValue=function(n,t){return this._matrix[n][t]},this.hasValue=function(n,t){return this._matrix[n][t]},this.setValue=function(n,t,l){this._matrix[n][t]?Array.isArray(this._matrix[n][t])?this._matrix[n][t].push(l):(this._matrix[n][t]=[this._matrix[n][t]],this._matrix[n][t].push(l)):this._matrix[n][t]=l},this.removeValue=function(n,t,l){if(Array.isArray(this._matrix[n][t])){const o=this._matrix[n][t].indexOf(l);this._matrix[n][t].splice(o,1),this._matrix[n][t]=this._matrix[n][t][0]}else this._matrix[n][t]=void 0}}function U(e){Ge.call(this,e);for(let n in e.BLOCKS)e.BLOCKS[n].forEach(t=>{this._matrix[n][t]=Q});this.getNewMatrix=function(){return new U(e).getMatrix()},this.isColumnBlock=function(n,t){return this.getValue(n,t)===Q},this.isPlayerCaught=function(n){if(!["enemy","player"].includes(n.type))return!1;const t=n.getLocation();if(Array.isArray(this._matrix[t.row][t.column])){let l=[];return this._matrix[t.row][t.column].forEach(o=>l.push(o.type)),l.includes("player")&&l.includes("enemy")}}}U.prototype=Object.create(U.prototype,{constructor:{value:U,enumerable:!1,writable:!0,configurable:!0}});function ke(e){const n=document.createElement("div"),t=this;this.boardCssSettings={},this.notifyCallback,this.gameMatrix=new U(e),this._cleanMatrix=this.gameMatrix.getNewMatrix(),this.getCleanMatrix=function(){return this._cleanMatrix},this.tearDown=function(){this.boardCssSettings={},this.notifyCallback=null,this.gameMatrix=null,n.remove()},this.onNotify=function(s){return this.notifyCallback=s,this.notifyCallback.bind(this.notifyCallback),this},this.notify=function(s,i){return this.notifyCallback.call(this.notifyCallback,s,i)},this.onWindowResize=function(){t.boardCssSettings=n.getBoundingClientRect()},this.draw=function(){return n.className="board",n.innerHTML=De(e),t.notify(p.APPEND_ELEMENT_TO_GAME,n),t.boardCssSettings=n.getBoundingClientRect(),this},this.addItem=function(s,i=0){const{row:r,column:f}=s.getLocation();if(t.gameMatrix.getValue(r,f)){i<he?t.addItem(s,++i):console.error("Failed to place item on board",s);return}t.gameMatrix.setValue(r,f,s),o(r,f,s)},this.moveItem=function(s,i){return new Promise((r,f)=>{const T=s.getLocation(),L=Ve(e,T,i);if(t.gameMatrix.isColumnBlock(L.row,L.column)){d(s,i),s.stoppedMoving(),f("Encounter block");return}s.setLocation(L),c(T,L,s),t.gameMatrix.setValue(L.row,L.column,s),h(s,i),s.stoppedMoving(),r(),t.checkIsPlayerCaught(s)})},this.checkIsPlayerCaught=function(s){t.gameMatrix.isPlayerCaught(s)&&(typeof s.caughtPlayer=="function"?s.caughtPlayer():s.enteredEnemyTerritory())},this.displayItem=function(s){ge(s.getDomElement())},this.updateCssTopAndLeft=function(s){const i=s.getLocation(),{top:r,left:f}=l(i.row,i.column),T=s.getDomElement(),L=s.getMiddleValues(),E=f-L.width+"px",v=r-L.height+"px";T.style.transform=`translate(${E}, ${v})`};function l(s,i){const f=n.querySelector(`[${e.ATTRIBUTE_DATA_ROW}="${s}"] [${e.ATTRIBUTE_DATA_COLUMN}="${i}"]`).getBoundingClientRect(),T=f.top-t.boardCssSettings.top+f.height/2,L=f.left-t.boardCssSettings.left+f.width/2;return{top:T,left:L}}async function o(s,i,r){const{top:f,left:T}=l(s,i);if(typeof W[r.type]!="function")return;const L=W[r.type].call(W[r.type],r.type,r==null?void 0:r.subType);L.style.transform=`translate(${T}px, ${f}px)`;const E=await t.notify(p.APPEND_STRING_AS_DOM_TO_THE_END_OF_GAME,L),v=E.getBoundingClientRect(),C={height:v.height/2,width:v.width/2},R=f-C.height+"px",m=T-C.width+"px";E.style.transform=`translate(${m}, ${R})`,r.attachDomElement(E).setMiddleValues(C)}function d(s,i){const r=s.getDomElement();let f="",T=r.className;T=T.replace(Le,L=>(f=q+L,"")).trim(),T=T.replace(ye,"").trim(),r.className=T,f&&f!==q&&r.classList.add(f),r.classList.add(se+i)}function h(s,i){t.updateCssTopAndLeft(s),d(s,i)}function c(s,i,r){_(i,r);const f=t.gameMatrix.getValue(i.row,i.column);f!=null&&f.isCollectable&&(r!=null&&r.canCollect)&&t.gameMatrix.removeValue(i.row,i.column,f),t.gameMatrix.removeValue(s.row,s.column,r)}function _(s,i){if(t.gameMatrix.isColumnBlock(s.row,s.column))return;const r=t.gameMatrix.getValue(s.row,s.column);t.notify(p.REMOVE_ELEMENT_BY_LOCATION,{oldItem:i,currentItem:r})}}function x(){this.type=null,this.canCollect=!1,this.isCollectable=!1,this._location={row:0,column:0},this._cssMiddleValues={width:-1,height:-1},this._element=null,this.getMiddleValues=function(){return this._cssMiddleValues},this.setMiddleValues=function(e){return this._cssMiddleValues=e,this},this.getDomElement=function(){return this._element},this.attachDomElement=function(e){return this._element=e,this},this.detachDomElement=function(){return this._element=null,this},this.getLocation=function(){return this._location},this.randomLocation=function(e){const{ROWS:n,COLUMNS:t}=e;return this._location={row:Math.floor(Math.random()*n),column:Math.floor(Math.random()*t)},this},this.setLocation=function(e){return this._location=e,this}}function P(){x.call(this),this.type="mobile",this._isMoving=!1,this._callbacks={move:null,moveEnded:null},this.onMoveEnded=function(e){return this._callbacks.moveEnded=e,this},this.isMoving=function(){return this._isMoving},this.onMove=function(e){return this._callbacks.move=e,this},this.stoppedMoving=function(){var e;return this._isMoving=!1,(e=this._callbacks.moveEnded)==null||e.call(this),this},this.move=function(e){return this._isMoving=!0,this._callbacks.move.call(this,e),this}}P.prototype=Object.create(x.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}});function We(e,n){let t={collected:null};n={...re[w.REGULAR],...n};function l(){x.call(this),this._id=e,this.type="collectable",this.subType=n.subType??w.REGULAR,this.isCollectable=!0,this.value=n.value,this.onCollected=function(o){return t.collected=o,this},this.collected=function(){return t.collected.call(t.collected,{id:this._id,value:this.value,subType:this.subType}),this}}return l.prototype=Object.create(x.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),new l}function Ye(){function e(){P.call(this),this.type="player",this.canCollect=!0,this._callbacks.enteredEnemyTerritory=null,this.onEnteredEnemyTerritory=function(n){return this._callbacks.enteredEnemyTerritory=n,this},this.enteredEnemyTerritory=function(){return this._callbacks.enteredEnemyTerritory.call(this._callbacks.enteredEnemyTerritory),this}}return e.prototype=Object.create(P.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),new e}function Fe(){function e(){P.call(this),this.type="enemy",this._callbacks.caughtPlayer=null,this._strategy=null,this.setStrategy=function(n,t){return this._strategy=new n(this,t),this},this.startStrategy=function(...n){var t;return(t=this._strategy)==null||t.start.apply(this._strategy,n),this},this.stopStrategy=function(){var n,t;return(t=(n=this._strategy)==null?void 0:n.stop)==null||t.call(this._strategy),this},this.onCaughtPlayer=function(n){return this._callbacks.caughtPlayer=n,this},this.caughtPlayer=function(){return this._callbacks.caughtPlayer.call(this._callbacks.caughtPlayer),this}}return e.prototype=Object.create(P.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),new e}function He(e){let n={player:null,enemies:[]},t=null,l=!0,o;function d(){l=!1,n.enemies.forEach(E=>{E.stopStrategy()})}function h(E){let v;n.player=E,E.onEnteredEnemyTerritory(()=>{l&&L(p.ENTERED_ENEMY_TERRITORY)}).onMoveEnded(()=>{l&&(v&&clearTimeout(v),v=setTimeout(s,Ee))}).onMove(C=>{l&&L(p.PLAYER_WANTS_TO_MOVE,{item:E,direction:C})})}function c(E){e.map(v=>v),n.enemies.push(E),E.onCaughtPlayer(()=>{l&&L(p.CAUGHT_PLAYER)}).onMove(function(v){l&&L(p.ENEMY_WANTS_TO_MOVE,{item:E,direction:v})})}function _(E){E.type==="player"?h(E):E.type==="enemy"&&c(E)}function s(){n.enemies.forEach(E=>{E.stopStrategy().startStrategy(n.player)})}let i=!1,r=null;function f(E,v){if(v===r&&i)return;const C=pe[E];if(r=v,i=!0,!v){n.player.move(C);return}n.player.move(C),o=setInterval(()=>{n.player.move(C)},_e)}function T(){return{keyup(E){!J.includes(E.key)||!l||(r=null,i=!1,o&&clearInterval(o))},keydown(E){!J.includes(E.key)||!l||(console.log(E.key,"down"),f(E.key,E.repeat))}}}function L(E,v){t.call(t,E,v)}return{getEventsCallbacks:T,itemsReadyToMove:s,setItemMovement:_,stopAllMovement:d,onEvent(E){return typeof E=="function"&&(t=E),this}}}const A={DROW_ON_BOARD:"drawOnBoard",ITEMS_READY:"itemsReady",DISPLAY_ITEM:"displayItem",EVENT_TRIGGERED:"eventTriggered"};function $e(e,n){let t=new He(n),l={collectables:0,enemies:0},o={required:0,notRequired:0},d={collectables:[],player:null,enemies:[]},h={[A.DROW_ON_BOARD]:null,[A.ITEMS_READY]:null,[A.DISPLAY_ITEM]:null,[A.EVENT_TRIGGERED]:null};function c(a,y){y&&"location"in y?a.setLocation(y.location):a.randomLocation(e.boardSettings)}function _(a){k.includes(a)?o.notRequired+=1:o.required+=1}function s(a){k.includes(a)?o.notRequired-=1:o.required-=1}function i(a,y){const D=new We(y,a);c(D,a),C(A.DROW_ON_BOARD,D),_(D.subType),D.onCollected(S=>{s(S.subType),delete d.collectables[S.id];const G=k.includes(D.subType)?p.BAD_COLLECTABLE_COLLECTED:p.COLLECTABLE_COLLECTED;C(A.EVENT_TRIGGERED,{eventName:G,eventData:S}),o.required===0&&C(A.EVENT_TRIGGERED,{eventName:p.NO_MORE_COLLECTABLES})}),d.collectables[y]=D}function r(a){const y=new Fe;t.setItemMovement(y),c(y,a),C(A.DROW_ON_BOARD,y),d.enemies.push(y)}function f(){if(e.collectables){if(typeof e.collectables=="number")for(let a=0;a<e.collectables;a++)i(null,a);else e.collectables.forEach(i);l.collectables=o.required}}function T(){const a=new Ye;t.setItemMovement(a),c(a,e.player),C(A.DROW_ON_BOARD,a),d.player=a}function L(){if(typeof e.enemies=="number"){for(let a=0;a<e.enemies;a++)r(null);l.enemies=e.enemies}else e.enemies.forEach(r),l.enemies=e.enemies.length}function E(){f(),T(),L(),C(A.ITEMS_READY,{statistics:l,eventsCallbacks:t.getEventsCallbacks()}),t.onEvent((a,y)=>{C(A.EVENT_TRIGGERED,{eventName:a,eventData:y})})}async function v(){m(a=>C(A.DISPLAY_ITEM,a)),await t.itemsReadyToMove()}function C(...a){const y=a[0];a.splice(0,1),h[y].apply(h[y],a)}function R(a,y){a in h&&typeof y=="function"&&(h[a]=y)}function m(a){[d.player,...d.enemies,...d.collectables].forEach(y=>{y&&a.call(a,y)})}return{loadItems:E,displayItems:v,forEach:m,getNativeEventsNames(){return Object.keys(t.getEventsCallbacks())},stopAllMovement(){return t.stopAllMovement(),d.player=null,d.collectables.splice(0,d.collectables.length),d.enemies.splice(0,d.enemies.length),this},onRequstToDrawOnBoard(a){return R(A.DROW_ON_BOARD,a),this},onItemsReady(a){return R(A.ITEMS_READY,a),this},onRequstToDisplayItem(a){return R(A.DISPLAY_ITEM,a),this},onEvent(a){return R(A.EVENT_TRIGGERED,a),this}}}function je(e,n,t){const l=t,o=new ke(l.boardSettings),d=new $e(l,o.getCleanMatrix());let h={listener:null,ready:null,tests:null},c={collectables:0},_=!0;o.onNotify((m,a)=>new Promise((y,D)=>{var S;m===p.APPEND_ELEMENT_TO_GAME?(e.append(a),y()):m===p.APPEND_STRING_AS_DOM_TO_THE_END_OF_GAME?(e.append(a),y(a)):m===p.REMOVE_ELEMENT_BY_LOCATION?a.oldItem.canCollect&&typeof((S=a.currentItem)==null?void 0:S.collected)=="function"&&setTimeout(()=>{a.currentItem.collected().getDomElement().remove(),a.currentItem.detachDomElement()},me):D()})).draw();function s(m,a){return h.listener.call(h.listener,m,a),this}function i(m){return h.listener=m,this}function r(m){return h.ready=m,this}function f(m){return this}function T(){d.displayItems(),typeof h.ready=="function"&&h.ready.call(h.ready,l)}function L(){_=!1,d.stopAllMovement(),s(p.LEVEL_STOPPED,{nativeEventsNames:d.getNativeEventsNames()})}function E(m){if(!_)return!1;L(),e.insertAdjacentHTML("beforeend",Pe()),e.querySelector("#level_status button").addEventListener("click",()=>s(p.RELOAD_CURRENT_LEVEL),{once:!0}),console.info("Level","failed:",m)}function v(){if(!_)return!1;L(),e.insertAdjacentHTML("beforeend",Be())}function C(){L(),o.tearDown(),e.querySelectorAll(".immobile,.mobile,#level_status").forEach(m=>m.remove())}function R(){d.onRequstToDrawOnBoard(o.addItem).onRequstToDisplayItem(o.displayItem).onItemsReady(m=>{s(p.LEVEL_STATISTICS,m.statistics),s(p.EVENTS_CALLBACKS,m.eventsCallbacks)}).onEvent(m=>{[p.PLAYER_WANTS_TO_MOVE,p.ENEMY_WANTS_TO_MOVE].includes(m.eventName)?o.moveItem.call(o.moveItem,m.eventData.item,m.eventData.direction):([p.BAD_COLLECTABLE_COLLECTED,p.COLLECTABLE_COLLECTED].includes(m.eventName)&&(c.collectables+=m.eventData.value),s(m.eventName,m.eventData))}).loadItems(),setTimeout(T,0)}return{number:n,type:t.type,start:R,onReady:r,listener:i,getReportedValues(){return c},onWindowResize:()=>{o.onWindowResize(),d.forEach(o.updateCssTopAndLeft)},tearDown:C,failed:E,completed:v,tests:f}}const H=(()=>{function e(){return{}}function n(l){const o=e();return l in o?o[l]:void 0}function t(l){}return{insertOrUpdate:t,getLevel(){return n("level")},getScore(){return n("score")}}})(),qe=400;function I(e){return new Promise((n,t)=>{e(),setTimeout(()=>{n()},qe)})}async function M(e,n){function t(){return new Promise(async l=>{if(n===0){l(!1);return}await I(e).then(()=>{l(--n)})})}for(;await t(););}async function Ke(e,n){console.log("-","Test","Level number:",e,"-"),await I(()=>{}),e===1?await M(()=>n.player.move(g.RIGHT),2):e===2?(await M(()=>n.player.move(g.UP),2),await M(()=>n.player.move(g.RIGHT),5),await M(()=>n.player.move(g.DOWN),2),await M(()=>n.player.move(g.LEFT),3)):e===3?(await M(()=>n.player.move(g.RIGHT),2),await I(()=>n.player.move(g.UP)),await M(()=>n.player.move(g.LEFT),2),await M(()=>n.player.move(g.UP),3),await M(()=>n.player.move(g.RIGHT),5),await I(()=>n.player.move(g.DOWN))):e===4&&(await I(()=>n.enemies[0].move(g.UP)),await I(()=>n.enemies[0].move(g.UP)),await I(()=>n.enemies[0].move(g.LEFT)),await I(()=>n.enemies[0].move(g.DOWN)))}const ze=["resize","scroll","keyup","keydown"];function Xe(){let e={},n=[];function t(c,_){c.call(c,_)}function l(c){!e[c.type]||e[c.type].length===0||e[c.type].forEach(_=>t(_,c))}function o(c){n.includes(c)||window.addEventListener(c,l)}function d(c){window.removeEventListener(c,l)}function h(c){var _;(_=e[c])==null||_.splice(0,e[c].length),delete e[c]}return{addMultiple(c){Object.keys(c).forEach(_=>{if(typeof c[_]=="function")this.add(_,c[_]);else throw new Error("Not implemented yet")})},add(c,_){if(ze.includes(c))return e[c]||(e[c]=[]),e[c].push(_),o(c),this},removeEventSubscribers(c){return h(c),d(c),this},removeByEventName(c){c in e||(h(c),d(c))},removeByEventNames(c){c.forEach(this.removeByEventName)},removeAll(){e={},n.forEach(c=>{h(c),d(c)})}}}const $={src:"",volume:.2,autoplay:!1,loop:!1},j={allowToPlay:!0,stopAllOtherSounds:!1,duration:0,dontUpdateOnMatchSrouce:!1};let N=[];function Ze(e,n){this.id=Ue(),this.audioSettings={...$},this.helpersSettings={...j},this.observers={ended:null},this.audio=new Audio,this.audio.addEventListener("ended",i=>{var r;(r=this.observers.ended)==null||r.call(this.observer,i.type),i.target.loop?(i.target.currentTime=0,i.target.play()):(N=N.filter(f=>f.id!==this.id),this.observers.ended=null)});function t(i){Object.keys(j).forEach(r=>{this.helpersSettings[r]=i[r]??j[r]}),this.helpersSettings.stopAllOtherSounds&&_(),Object.keys($).forEach(r=>{this.audioSettings[r]=i[r]??$[r],r==="autoplay"&&!this.helpersSettings.allowToPlay&&(this.audioSettings[r]=!1),this.audio[r]=this.audioSettings[r]}),this.helpersSettings.duration>0&&this.audio.addEventListener("timeupdate",l.bind(this)),N.push({id:this.id,audio:this.audio}),this.audioSettings.autoplay&&o.call(this)}function l(i){i.target.currentTime>=this.helpersSettings.duration&&(this.audio.pause(),this.audio.removeEventListener("timeupdate",l),this.audio.dispatchEvent(new Event("ended")))}function o(){this.helpersSettings.allowToPlay&&this.audio.play().then(()=>{typeof n=="function"&&n.call(n)})}function d(){this.audio.pause()}function h(){d.call(this),this.audio.currentTime=0}function c(i){const r=i==null?void 0:i.dontUpdateOnMatchSrouce;(!r||r&&this.audioSettings.src!==i.src)&&(h.call(this),t.call(this,i))}function _(){N.forEach(i=>{i.audio.pause(),i.audio.currentTime=0}),N.splice(0,N.length)}function s(i){typeof i=="function"&&(this.observers.ended=i)}return t.call(this,e),{play:o.bind(this),updateResource:c.bind(this),pause:d.bind(this),stop:h.bind(this),stopAllSounds:_,onEnded:s.bind(this)}}function B(e,n){let t,l;o(e);function o(d){t=ve[d],t={...t,src:Te+t.src},!l&&(l=new Ze(t,()=>{console.log("Audio playing/played")}))}return{...l,updateResource:d=>{o(d),l.updateResource.call(l,t)}}}function Qe(){let e;const n={all_game_sounds:ne,collectables_sounds:oe,level_sounds:le};function t(l){e?e.updateResource(l):e=new B(l),n.all_game_sounds&&n.level_sounds&&e.play()}return{activeBackgroundSound(l){const o=[ee.MEDIUM,ee.HARD].includes(l)?b.HARD_LEVEL_BACKGROUND:b.DEFAULT_BACKGROUND;t(o)},updateBackgroundSound(){},playBackgroundSound(l){e?e.updateResource(l):e=new B(l),n.all_game_sounds&&n.level_sounds&&e.play()},playLevelComplete(l,o){!n.all_game_sounds||!n.level_sounds?o():new B(b.LEVEL_COMPLETED).onEnded(o)},playLevelFailed(l){n.all_game_sounds&&n.level_sounds&&new B(b.LEVEL_FAILED)},playCollectableCollected(l){if(n.all_game_sounds&&n.collectables_sounds){const o=l?b.COLLECTABLE_COLLECTED:b.BAD_COLLECTABLE_COLLECTED;new B(o)}},playGameCompleted(){t(b.GAME_COMPLETED)},playLevelNotFound(){t(b.LEVEL_NOT_FOUND)},stopAllSounds(){e==null||e.stopAllSounds()},setUIControllers(l){l&&l.querySelectorAll("[type=checkbox]").forEach(o=>{o.addEventListener("change",d=>{n[d.target.id]=d.target.checked,(d.target.id==="all_game_sounds"||d.target.id==="level_sounds")&&(n.all_game_sounds&&n.level_sounds?e==null||e.play():e==null||e.stop())})})}}}function Je(e){let n={level:0,score:0,collectables:0,enemies:0};function t(o,d){const h=e.querySelector(o);h&&(h.innerText=d)}function l(o){t("#level_number",o),t("#remains_collectable",n.collectables),t("#score",n.score)}return{updateGameUIs:l,getCollectables(){return n.collectables},getScore(){return n.score},setScore(o){t("#score",o)},updateScore(o){n.score+=o},isScoreLessThenZero(){return n.score<0},onLevelRestart(o){n.score-=o},onGoodCollectableCollected(o){o===p.COLLECTABLE_COLLECTED&&--n.collectables},setCollectables(o){n.collectables=o}}}function et(e,n=null){let t,l,o=-1,d,h=null,c=new Xe,_=new Qe,s=new Je(e),i={loadHeader:!0,loadStatistics:!0,loadSounds:!0};const r={[p.COLLECTABLE_COLLECTED]:L,[p.BAD_COLLECTABLE_COLLECTED]:L,[p.EVENTS_CALLBACKS](u){c.addMultiple(u)},[p.LEVEL_STATISTICS](u,O){s.setCollectables(u.collectables),E(O)},[p.LEVEL_STOPPED](u){c.removeByEventNames(u.nativeEventsNames)},[p.NO_MORE_COLLECTABLES](u){E(),t.completed(),_.playLevelComplete(u,R)},[p.CAUGHT_PLAYER]:T,[p.ENTERED_ENEMY_TERRITORY]:T,[p.RELOAD_CURRENT_LEVEL]:m};function f(){H.getScore()&&s.setScore(H.getScore()),_.activeBackgroundSound(t.type)}function T(u,O){_.playLevelFailed(u),t.failed(O)}function L(u,O){s.updateScore(u.value),s.onGoodCollectableCollected(O),_.playCollectableCollected(u.value>0),a(O)}function E(u){let O={collectables:s.getCollectables(),level:t.number};u!=="levelStatistics"&&(O.score=s.getScore())}function v(u){u===void 0?_.stopAllSounds():u.message==="-No more levels-"?d?(_.playGameCompleted(),d.insertAdjacentHTML("beforeend",Ne())):console.error("Level wrapper not found"):u.message==="Level not found"?(_.playLevelNotFound(),d.insertAdjacentHTML("beforeend",we())):console.error(u)}function C(u){if(Object.keys(l).length<u)throw new RangeError("-No more levels-");if(typeof l[u]>"u")throw new RangeError("Level not found");return u}function R(){setTimeout(()=>{const u=t.number;t.tearDown(),S.start(u+1)},fe)}function m(){_.stopAllSounds(),s.onLevelRestart(t.getReportedValues().collectables),t.tearDown(),S.start(t.number)}function a(u){s.isScoreLessThenZero()&&(_.playLevelFailed(),t.failed(u))}function y(u,O){typeof r[u]=="function"?r[u].call(r[u],O,u):[X.TEST,X.DEV].includes(Z)&&console.log(u,...O),typeof h=="function"&&h.call(h,{eventName:u,eventValues:O}),s.updateGameUIs(t.number)}function D(u){return u||(o>0?o:(t=H.getLevel())?t:ue)}const S={start(u){u=D(u);try{C(u)}catch(O){v(O);return}return t=new je(d,u,l[u]),t.onReady(f).listener(y).tests(Ke).start(),t},onWindowResize(){t==null||t.onWindowResize()},tearDown(){t.tearDown()}};async function G(u){if(n)l=n,o=-1;else{const{LEVELS:O,FORCE_DEFAULT_LEVEL_NUMBER:ae}=await ce(Object.assign({"./levels_settings/env_settings/dev.js":()=>V(()=>import("./dev-339a54f1.js"),["./dev-339a54f1.js","./level_constructor-e2d949b5.js","./index-c9abb733.js","./index-6ba7c051.css"],import.meta.url),"./levels_settings/env_settings/prod.js":()=>V(()=>import("./prod-752d44b4.js"),["./prod-752d44b4.js","./level_constructor-e2d949b5.js","./index-c9abb733.js","./index-6ba7c051.css"],import.meta.url),"./levels_settings/env_settings/test.js":()=>V(()=>import("./test-6ac656d5.js"),["./test-6ac656d5.js","./level_constructor-e2d949b5.js","./index-c9abb733.js","./index-6ba7c051.css"],import.meta.url),"./levels_settings/env_settings/welcome.js":()=>V(()=>import("./welcome-176fec8d.js"),["./welcome-176fec8d.js","./level_constructor-e2d949b5.js","./index-c9abb733.js","./index-6ba7c051.css"],import.meta.url)}),`./levels_settings/env_settings/${Z}.js`);l=n??O,o=ae}document.body.classList.add("game-page"),e.insertAdjacentHTML("afterbegin",Re(i)+Se()),d=document.querySelector("#level_wrapper"),S.start(u),_.setUIControllers(e.querySelector("#game_sounds"))}return{start(u){return G(u),this},noHeader(){return i.loadHeader=!1,this},toggleStatistics(u){return i.loadStatistics=u,this},toggleSounds(u){return i.loadSounds=u,this},setObserver(u){return h=u,this},setWindowResizeObserver(){return c.add("resize",S.onWindowResize).add("scroll",S.onWindowResize),this},tearDown(){c.removeAll(),document.body.classList.remove("game-page"),d=null,e.innerHTML="",S.tearDown()}}}const ot=Object.freeze(Object.defineProperty({__proto__:null,default:et},Symbol.toStringTag,{value:"Module"}));export{de as A,nt as B,re as C,te as E,et as G,W as I,pe as K,ee as L,k as N,J as V,p as a,w as b,ot as c,Ce as g,ge as r,lt as s};
